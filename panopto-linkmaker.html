<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Panopto Link Maker</title>
	<link rel="stylesheet" media="screen" href="style.css">
</head>
<body>
<h1>Panopto Link Maker</h1>

<p>Enter Panopto Viewer Link:</p>

<p><input type="text" value="" id="textbox"></p>

<p>Click the button to get links to other viewing options.</p>

<button onclick="getLinks()">Get links</button>

<p>
<ul>
    <li id="pnpt">Panopto Viewer</li>
    <li id="vidn">MP4 Video Podcast Download</li>
    <li id="view">MP4 Video Podcast View</li>
    <li id="audn">MP3 Audio Podcast Download</li>
    <li id="lstn">MP3 Audio Podcast Listen</li>
</ul>
</p>

<p id="embedcodelabel"></p>
<p id="embedcode"></p>
<p id="embedlabel"></p>
<p id="embed"></p>

<hr>

<p><a href="https://github.com/brianhigh/panopto-linkmaker">https://github.com/brianhigh/panopto-linkmaker</a></p>


<script>
function validate(url) {
    // Check that input url matches regex pattern for valid url per RFC 3986
    // Source: https://tools.ietf.org/html/rfc3986#page-50
    var pattern = /^(([^:\/?#]+):)?(\/\/([^\/?#]*))?([^?#]*)(\?([^#]*))?(#(.*))?/;
    
    if (pattern.test(url)) {
        return true;
    } 
    alert("Link is not valid!");
    return false;
}

function makeLink(elemid, link) {
    try {
        var str = document.getElementById(elemid).innerHTML;
        var strlnk = str.link(link);
        document.getElementById(elemid).innerHTML = strlnk;
    }
    catch(err) {
        alert("Can't create link! " + err.stack);
        return false;
    }
    return true;
}

function getLinks() {
    // Check that input url matches a generic url pattern
    var vidurl = document.getElementById("textbox").value;
    if (validate(vidurl) !== true) {
        return false;
    }

    // Parse url into a base path and a video id
    var lnkarr = vidurl.split("/Pages/Viewer.aspx?id=");
    var urlstr = lnkarr[0];
    var id = lnkarr[1];
    
    // Check for hexadecimal id string
    var idpattern = /^[0-9a-f\-]+$/;
    if (idpattern.test(id) !== true) {
        alert("Link is not valid!");
        return false;
    } 

    // Make links for video (mp4) and audio (mp3) download and streaming
    makeLink("pnpt", vidurl);
    makeLink("vidn", urlstr + "/Podcast/Download/" + id + ".mp4");
    makeLink("view", urlstr + "/Podcast/Stream/" + id + ".mp4");
    makeLink("audn", urlstr + "/Podcast/Download/" + id + ".mp3");
    makeLink("lstn", urlstr + "/Podcast/Stream/" + id + ".mp3");
    
    // Construct HTML code for embedded viewer
    var embedlnk = urlstr + "/Pages/Embed.aspx?id=" + id + "&v=1";
    var embedifm = '<iframe src="' + embedlnk + 
        '" width="720" height="480" frameborder="0"></iframe>';
    
    // Show HTML code for embedding the video into a web page
    document.getElementById("embedcodelabel").innerHTML = 
        'Embedded viewer HTML code:';
    document.getElementById("embedcode").innerHTML = 
        '<textarea cols="50" rows="4">' + embedifm + '</textarea>';
    
    // Show embedded video
    document.getElementById("embedlabel").innerHTML = 'Embedded viewer:';
    document.getElementById("embed").innerHTML = embedifm;
}
</script>

</body>
</html>